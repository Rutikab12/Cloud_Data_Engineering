--ADVANCED SQL 50 LEETCODE

-------------------------------------------------------------------------------------------------------------------------------------------
--leetcode : 1440
--evaluate boolen expression

--first tale values of variables in expression table using left join
--and then use case when
select e.*,v1.value as lto,v2.value as rto,
case when e.operator='>' then if((v1.value > v2.value)=0,'false','true')
when e.operator='<' then if((v1.value < v2.value)=0,'false','true')
when e.operator='=' then if((v1.value = v2.value)=0,'false','true')
else null end as value
from expressions e
left join variables v1
on e.left_operand=v1.name
left join Variables v2
on e.right_operand=v2.name;

-------------------------------------------------------------------------------------------------------------------------------------------
--leetcode : 1212
--Team Scores in Football Tournament

--first do the left join on team_id=guest_id and host_id we will get all team_id.
--group by team_id and use sum(case when)
--order by points desc,team_id

with cte as(
select m.*,t.team_id,t.team_name,
SUM(
        CASE
            WHEN team_id = host_team
            AND host_goals > guest_goals THEN 3
            WHEN team_id = guest_team
            AND guest_goals > host_goals THEN 3
            WHEN host_goals = guest_goals THEN 1
            ELSE 0
        END
    ) AS num_points
from Teams t
left join Matches m
on t.team_id=m.host_team or t.team_id=m.guest_team
group by t.team_id)

select team_id,team_name,num_points from cte
order by 3 desc,1;
-------------------------------------------------------------------------------------------------------------------------------------------
--leetcode : 1890
--Last Login by user

--use year() to get year=2020 and take max(time_stamp)
select user_id,max(time_stamp) as last_stamp from logins
where year(time_stamp)=2020
group by user_id;

-------------------------------------------------------------------------------------------------------------------------------------------
--leetcode : 511
--Game Play Analysis I

--use min() to get first login date and group by plyaer_id
select player_id,min(event_date) as first_login from activity group by 1;

-------------------------------------------------------------------------------------------------------------------------------------------
--leetcode : 511
--Game Play Analysis I

--do inner join on product_id, sum(w*l*h*units) as volume
--group by warehouse_name

select w.name as warehouse_name,
sum(width*length*height*units) as volume
from Products p
inner join Warehouse w
on p.product_id=w.product_id
group by 1;

-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------



-------------------------------------------------------------------------------------------------------------------------------------------



-------------------------------------------------------------------------------------------------------------------------------------------



-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------




-------------------------------------------------------------------------------------------------------------------------------------------